var source=$("#template-vocabulary-list").text(),template=Handlebars.compile(source),docs=null,elLeft=document.querySelector("#header .glyphicon-circle-arrow-left"),elRight=document.querySelector("#header .glyphicon-circle-arrow-right"),elSortBy=document.querySelector("#sort-by"),sortBy=elSortBy.value||"",page=0,pages=0,PER_PAGE=10;Handlebars.registerHelper("linkto",function(a){a=Math.max(Math.ceil(a/PER_PAGE)-1,0)*PER_PAGE+1;return a+"-"+(a+PER_PAGE-1)});
var fetch=function(a,b){$.ajax({url:"/list/page/"+b+"?sortBy="+a,headers:{"X-Requested-With":"XMLHttpRequest"}}).done(function(a){docs=a.docs;b=a.page;pages=a.pages;0===b?elLeft.classList.add("disabled"):elLeft.classList.remove("disabled");b===pages-1?elRight.classList.add("disabled"):elRight.classList.remove("disabled");a.docs.forEach(function(a){var b=RegExp("("+a.vocabulary+")([^\\s]*)","gi");a.sentences.forEach(function(a,c){a.content=a.content.replace(b,"<dfn>$1$2</dfn>")})});document.querySelector("#content").innerHTML=
template(a)})};fetch(sortBy,0);elSortBy.addEventListener("change",function(){sortBy=this.value;$.cookie("sortBy",sortBy);fetch(sortBy,0)});document.body.addEventListener("click",function(a){var b=a.target;if(b.classList.contains("disabled"))return!1;if(b.classList.contains("glyphicon-circle-arrow-right")||b.classList.contains("glyphicon-circle-arrow-left"))a.preventDefault(),page=b.classList.contains("glyphicon-circle-arrow-right")?page+1:page-1,fetch(sortBy,page)});
document.body.addEventListener("keypress",function(a){console.log(a,a.which);switch(a.which){case 122:page=0;break;case 118:page=pages-1;break;case 99:page+=1;page=Math.min(page,pages-1);break;case 120:page-=1,page=Math.max(0,page)}fetch(sortBy,page)});document.body.addEventListener("click",function(a){var b=a.target;a.target.classList.contains("pronun")&&b.dataset.s&&(a=new Audio,a.src=b.dataset.s,a.play())});
var renderPopOver=function(a){var b=null;docs.some(function(c){b=c;return c.vocabulary===a});var c=$("#template-popover").text();return Handlebars.compile(c)({doc:b})};
$("body").popover({selector:"#content .sentence dfn",trigger:"hover",title:function(){return $(this).closest("dd").data("v")},html:!0,content:function(){var a=$(this).closest("dd").data("v");return renderPopOver(a)},placement:function(a,b){var c=b.getBoundingClientRect(),d=$(window).width(),e=$(window).height();return 245>d-c.left-c.width?"left":120>e-c.top-c.height?"top":120>c.top?"bottom":"right"}});var noop=function(){alert("a function never been called")};
